#!/bin/bash

# This script is used to start the server
# It takes one argument:
#   - dev: starts the server in cargo-watch mode
#   - prod: starts the server in production mode
# It takes one option to specify the level of logging:
#   --log-level=info: sets the log level to info (default)
#   --log-level=debug: sets the log level to debug
#   --log-level=warn: sets the log level to warn
#   --log-level=error: sets the log level to error

# The script will exit with an error if the argument is not dev or prod
# The script will exit with an error if the log level is not valid
# The script will exit with an error if the server is already running

MODE=$1
LOG_LEVEL=$2

if [ "$MODE" = "dev" ]; then
    echo "Starting server in dev mode"
    # if log level is set to any value
    if [ -n "$LOG_LEVEL" ]; then
        echo "Setting log level to $LOG_LEVEL"
        RUST_LOG=$LOG_LEVEL cargo run -p server
    elif [ -z "$LOG_LEVEL" ]; then
        echo "Setting log level to info"
        RUST_LOG=info cargo run -p server
    else
        echo "Invalid log level"
        echo "Usage: server [dev|prod] [info|debug|warn|error]"
        exit 1
    fi
elif [ "$MODE" = "prod" ]; then
    echo "Starting server in prod mode"
    for i in "$@"
    do
    case $i in
        --log-level=*)
        LOG_LEVEL="${i#*=}"
        shift
        ;;
    esac
    done
else
    echo "Invalid mode"
    echo "Usage: server [dev|prod] [info|debug|warn|error]"
    exit 1
fi